# Phase 13: Discount & Promotion System

## üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÅ‡∏•‡∏∞ Promotion ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏°‡∏¥‡∏ï‡∏¥:
- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß
- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (First-time discount)
- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠ (Media services)
- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Digital Download
- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î Subscription
- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î Credit Purchase
- ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ

---

## üìã Features

### 1. Discount Types
- **Percentage Discount** - ‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (‡πÄ‡∏ä‡πà‡∏ô 10%, 20%)
- **Fixed Amount Discount** - ‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô ‡∏ø100, ‡∏ø500)
- **Free Item** - ‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏á‡∏ü‡∏£‡∏µ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ü‡∏£‡∏µ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
- **Buy X Get Y** - ‡∏ã‡∏∑‡πâ‡∏≠ X ‡πÑ‡∏î‡πâ Y (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠ 2 ‡πÅ‡∏ñ‡∏° 1)

### 2. Discount Scopes
- **Trip Discounts** - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏£‡∏¥‡∏õ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß
- **Activity Discounts** - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
- **Media Service Discounts** - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠ (Image, Video, Music generation)
- **Digital Download Discounts** - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Digital Download
- **Subscription Discounts** - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î Subscription Plans
- **Credit Purchase Discounts** - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ Credits
- **Content Access Discounts** - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤

### 3. Discount Rules
- **First-Time User** - ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- **Minimum Purchase** - ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ‡∏ø1000)
- **User Group** - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÄ‡∏ä‡πà‡∏ô Member, Premium)
- **Time-Based** - ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î, ‡∏ä‡πà‡∏ß‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô)
- **Quantity-Based** - ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠ 3 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)
- **Combination** - ‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç

### 4. Discount Management
- **Create Discount Codes** - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î
- **Set Validity Period** - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- **Usage Limits** - ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
- **User Limits** - ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- **Track Usage** - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- **Analytics** - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•

### 5. Auto-Apply Discounts
- **Automatic Application** - ‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà)
- **Best Discount Selection** - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- **Stack Discounts** - ‡∏£‡∏ß‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß (‡∏ñ‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï)

---

## üèóÔ∏è Architecture

### Database Schema

```sql
-- Discount Codes
CREATE TABLE discount_codes (
    id UUID PRIMARY KEY,
    code VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    discount_type VARCHAR(50) NOT NULL, -- "percentage", "fixed_amount", "free_item", "buy_x_get_y"
    discount_value DECIMAL(10,2), -- Percentage or amount
    min_purchase_amount DECIMAL(10,2),
    max_discount_amount DECIMAL(10,2), -- For percentage discounts
    applicable_to VARCHAR(50), -- "trip", "activity", "media_service", "digital_download", "subscription", "credit", "content", "all"
    applicable_item_ids UUID[], -- Specific items (optional)
    valid_from TIMESTAMPTZ NOT NULL,
    valid_until TIMESTAMPTZ NOT NULL,
    usage_limit INTEGER, -- Total usage limit
    usage_count INTEGER DEFAULT 0,
    user_limit INTEGER, -- Per user limit
    first_time_only BOOLEAN DEFAULT false,
    user_group VARCHAR(50), -- "all", "member", "premium", "staff"
    status VARCHAR(50) DEFAULT "active", -- "active", "inactive", "expired"
    auto_apply BOOLEAN DEFAULT false,
    stackable BOOLEAN DEFAULT false,
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Discount Usage
CREATE TABLE discount_usage (
    id UUID PRIMARY KEY,
    discount_code_id UUID REFERENCES discount_codes(id),
    user_id UUID REFERENCES auth.users(id),
    order_id UUID, -- Reference to order/transaction
    item_type VARCHAR(50), -- "trip", "activity", "media_service", etc.
    item_id UUID,
    original_amount DECIMAL(10,2),
    discount_amount DECIMAL(10,2),
    final_amount DECIMAL(10,2),
    used_at TIMESTAMPTZ DEFAULT NOW()
);

-- Discount Analytics
CREATE TABLE discount_analytics (
    id UUID PRIMARY KEY,
    discount_code_id UUID REFERENCES discount_codes(id),
    date DATE,
    usage_count INTEGER DEFAULT 0,
    total_discount_amount DECIMAL(10,2) DEFAULT 0,
    total_revenue DECIMAL(10,2) DEFAULT 0,
    new_users_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(discount_code_id, date)
);
```

---

## ‚úÖ Success Criteria

- [ ] Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á Discount Codes ‡πÑ‡∏î‡πâ
- [ ] ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î
- [ ] ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å Scope (Trip, Activity, Media, etc.)
- [ ] ‡∏£‡∏∞‡∏ö‡∏ö Auto-apply ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
- [ ] ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Usage ‡πÅ‡∏•‡∏∞ Analytics
- [ ] Frontend UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î
- [ ] Integration ‡∏Å‡∏±‡∏ö Monetization System

---

**Status:** üìã Ready for Implementation

